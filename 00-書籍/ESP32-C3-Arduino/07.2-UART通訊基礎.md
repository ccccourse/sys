### 7.2 **UART 通訊基礎**

UART（Universal Asynchronous Receiver-Transmitter）是一種常見的串行通信協議，用於兩個設備之間的點對點數據傳輸。與 I2C 和 SPI 不同，UART 是一種異步通信協議，這意味著它不需要時鐘信號，數據以比特流的形式按預定的波特率進行傳輸。

ESP32-C3 支援多個 UART 接口，並提供強大的硬體和軟體支援來進行高效的串行通信。UART 在許多應用中非常有用，如與外部模塊（例如 GPS 模塊、藍牙模塊、無線模塊等）進行通信。

本節將介紹 UART 通信的基本原理、設置和實踐範例。

---

### 1. **UART 通信原理**

在 UART 通信中，數據是按字節（8 位）進行傳輸的，每個字節會被分為以下部分：
- **起始位（Start Bit）：** 由一個低電平的信號表示，表示數據傳輸的開始。
- **數據位（Data Bits）：** 這是實際傳輸的數據，通常是 8 位或 7 位。
- **停止位（Stop Bit）：** 由一個或兩個高電平的信號表示，表示數據傳輸的結束。

UART 通信的速率是由 **波特率（Baud Rate）** 決定的，通常以每秒位數（bps）表示。常見的波特率有 9600、115200 等。

#### **典型的 UART 連接：**
- **TX（Transmitter）：** 傳送數據的端口。
- **RX（Receiver）：** 接收數據的端口。

---

### 2. **UART 連接設置**

ESP32-C3 提供了多個 UART 接口，並且每個接口都可以根據需要分配不同的引腳。通常，使用兩個引腳來進行 UART 通信：
- **TX（發送）**
- **RX（接收）**

#### **程式碼範例：設置並使用 UART 進行通信**

假設我們需要與一個外部設備（例如 GPS 模塊）進行 UART 通信。以下範例展示了如何使用 ESP32-C3 的 UART 接口接收來自 GPS 模塊的數據。

```cpp
#include <HardwareSerial.h>  // 引入硬體串口庫

HardwareSerial mySerial(1);  // 使用硬體串口 1

#define RX_PIN 16  // 設定 RX 引腳
#define TX_PIN 17  // 設定 TX 引腳

void setup() {
  Serial.begin(115200);  // 初始化 USB 串口
  mySerial.begin(9600, SERIAL_8N1, RX_PIN, TX_PIN);  // 設定 UART1 的波特率、數據位、停止位，並指定 RX 和 TX 引腳

  Serial.println("UART Communication Test");
}

void loop() {
  if (mySerial.available()) {  // 檢查是否有可用的數據
    char incomingByte = mySerial.read();  // 讀取接收到的字節
    Serial.print("Received: ");
    Serial.println(incomingByte);  // 顯示接收到的數據
  }
  delay(100);  // 延遲 100 毫秒
}
```

#### **程式碼解釋：**
1. **HardwareSerial mySerial(1);**: 創建一個硬體串口對象，這裡使用的是 `UART1`，ESP32-C3 共有 3 個 UART 接口（`UART0`、`UART1`、`UART2`），你可以根據需要選擇。
2. **mySerial.begin(9600, SERIAL_8N1, RX_PIN, TX_PIN);**: 初始化串口，設置波特率為 9600，數據位為 8 位，停止位為 1 位，並指定接收（RX）和發送（TX）引腳。
3. **mySerial.available()**: 檢查串口接收緩衝區是否有數據。如果有數據可讀，返回非零值。
4. **mySerial.read()**: 讀取接收到的一個字節數據，並將其顯示在串口監控器上。

---

### 3. **波特率與數據格式**

在設置 UART 通信時，選擇正確的波特率和數據格式至關重要。常見的波特率和數據格式如下：

| 波特率       | 常見用途               | 數據格式    |
|------------|----------------------|-----------|
| 9600       | 低速設備，如傳感器        | 8 位數據，無奇偶校驗位，1 位停止位  |
| 115200     | 高速設備，如 GPS 模塊     | 8 位數據，無奇偶校驗位，1 位停止位  |
| 57600      | 較為常見的中速通信速率   | 8 位數據，無奇偶校驗位，1 位停止位  |

在進行 UART 通信時，傳輸端和接收端必須使用相同的波特率和數據格式。波特率過高或過低都可能導致數據丟失或通信錯誤。

---

### 4. **常見 UART 通信問題與故障排除**

- **傳輸錯誤：** 如果數據接收不正確，通常是由於波特率不匹配。檢查兩端設置的波特率是否相同。
- **數據丟失：** 如果 UART 緩衝區溢出，數據可能會丟失。此時，可以提高波特率或減少數據傳輸頻率。
- **線路干擾：** 長距離通信或使用不良的接地設置可能會導致信號干擾。確保使用適當的接地和良好的連接線。

---

### 5. **總結**

UART 是一種簡單且高效的串行通信協議，廣泛應用於物聯網設備之間的數據傳輸。ESP32-C3 提供了多個 UART 接口，開發者可以根據需要靈活設置使用的引腳和通信參數。在設計基於 UART 的通信時，確保設置正確的波特率和數據格式，並注意故障排除。