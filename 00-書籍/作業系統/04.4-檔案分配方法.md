### 4.4 檔案分配方法

檔案分配方法是作業系統用來管理檔案在儲存設備上如何分佈的技術。這些方法決定了檔案的資料如何儲存在磁碟或其他儲存介質上，以及如何確保高效的資料存取和管理。適當的檔案分配方法能夠提高檔案存取的效率、減少空間浪費，並降低碎片化的問題。

常見的檔案分配方法包括連續分配、鏈接分配和索引分配。每種方法有不同的優缺點，且適用於不同的使用情境。

#### 4.4.1 連續分配 (Contiguous Allocation)

連續分配是最簡單且最直觀的檔案分配方法。在這種方法中，檔案的所有資料區塊被儲存在儲存設備上的連續區域中。這意味著，當檔案創建時，作業系統會為該檔案分配一塊連續的儲存空間，並在其間儲存檔案的所有資料。

- **優點**：
  1. **簡單易實現**：由於檔案的所有資料儲存在一個連續區域內，檔案的存取方式簡單且直接。
  2. **效能高**：檔案的資料連續儲存，磁碟讀寫操作的效率高，因為磁頭不需要頻繁跳躍，能夠連續讀取資料。
  
- **缺點**：
  1. **碎片化問題**：隨著檔案的創建和刪除，儲存設備上會產生空閒的區塊，這些空閒區塊可能不足以容納新的檔案，造成空間浪費和碎片化。
  2. **靈活性差**：檔案的大小通常是固定的，如果需要擴展檔案，可能需要將檔案移動到更大的區塊，這樣會造成額外的成本。
  
- **適用場景**：這種方法適用於檔案大小已知且不會頻繁變更的情況，適合處理大型資料庫等需要大量連續資料存取的應用。

#### 4.4.2 鏈接分配 (Linked Allocation)

鏈接分配方法將檔案資料分散存儲在磁碟的不同區塊，並使用鏈接來表示資料塊之間的關聯。每個資料塊包含兩個部分：一部分是實際資料，另一部分是下一個資料塊的位址（即指標）。這樣，作業系統可以透過鏈接來追蹤檔案的資料塊，無需將它們儲存在連續區域。

- **優點**：
  1. **解決碎片化問題**：由於檔案的資料不必儲存在連續的區域，這可以避免磁碟上空間的碎片化問題。
  2. **靈活性高**：檔案大小可以動態增長或縮小，因為只需在磁碟上找到空閒區塊並將資料塊鏈接起來。

- **缺點**：
  1. **存取效率低**：因為每次讀取資料時，都需要沿著鏈結節點進行多次磁碟操作，這會導致較高的磁碟尋道時間和延遲。
  2. **磁碟操作多**：在尋找檔案資料塊時，磁碟頭可能需要頻繁跳躍到不同的位置，這會降低讀寫效率。
  
- **適用場景**：鏈接分配通常適用於需要頻繁變更檔案大小或對連續儲存要求不高的應用，如文檔、日志檔案等。

#### 4.4.3 索引分配 (Indexed Allocation)

索引分配方法使用一個索引區塊來記錄檔案的所有資料區塊的位置。每個檔案都有一個索引表，該表列出所有存儲該檔案資料的磁碟區塊。索引區塊本身可以儲存在磁碟的其他地方，並且可以是固定大小或動態分配。

- **優點**：
  1. **隨機存取效率高**：索引分配方法可以直接從索引表中找到資料塊的位置，減少了尋道時間，提供較高效的隨機存取。
  2. **解決碎片化問題**：檔案資料可以分散儲存在磁碟的不同位置，而不會產生碎片化，索引表負責管理所有資料區塊的位置。
  
- **缺點**：
  1. **索引表開銷**：每個檔案都需要額外的索引區塊來存儲資料塊的位置，這會增加儲存需求。尤其是當檔案非常大時，索引表可能會變得很龐大。
  2. **管理複雜**：索引表的管理相對較為複雜，尤其是在多層次索引表的情況下，會涉及到額外的查找和存取操作。
  
- **適用場景**：索引分配適用於需要高效隨機存取的情況，尤其是在處理大量小檔案時。例如，操作系統的執行檔案、資料庫等。

#### 4.4.4 綜合比較

| 分配方法      | 優點                          | 缺點                          | 適用場景                |
|---------------|-------------------------------|-------------------------------|-------------------------|
| 連續分配      | 存取效能高，實現簡單           | 碎片化問題，靈活性差          | 檔案大小固定且不會變更  |
| 鏈接分配      | 解決碎片化問題，靈活性高       | 存取效能低，磁碟操作多        | 檔案大小動態變化，適合隨機存取 |
| 索引分配      | 隨機存取效能高，解決碎片化問題 | 需要額外的索引表，管理複雜    | 大量小檔案或需要高效隨機存取的應用 |

#### 小結

檔案分配方法對於作業系統性能、磁碟空間利用率以及檔案存取的效率有著重要影響。不同的分配方法各有優缺點，適用於不同的應用場景。在設計檔案系統時，選擇適合的檔案分配方法能夠幫助優化檔案管理和提高系統的整體效能。