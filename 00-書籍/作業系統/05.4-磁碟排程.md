### 5.4 磁碟排程

磁碟排程（Disk Scheduling）是操作系統中負責管理磁碟存取請求的一個重要子系統，目的是決定磁碟讀寫操作的執行順序，以提高磁碟的使用效率，降低磁碟的平均存取時間。由於磁碟是順序存取的設備，相比於隨機存取設備（如RAM），讀寫頭需要移動到正確的磁碟位置，這樣的移動帶來了顯著的延遲。因此，磁碟排程的目的是減少磁碟臂（磁碟讀寫頭）在磁碟表面上的移動，從而提高I/O性能。

#### 5.4.1 磁碟存取的基本概念

磁碟的存取過程涉及到磁碟驅動器的讀寫頭在磁碟表面上的移動，並在磁碟上的特定位置讀取或寫入數據。每個I/O請求通常包括兩個主要的元素：

- **磁碟位置（磁碟柱面，Cylinder）**：磁碟表面被分為若干軌道，每個軌道被稱為柱面。在磁碟排程中，磁碟的「位置」指的是磁碟讀寫頭要移動到的目標柱面。
  
- **磁碟排程時間**：磁碟存取時間可以分為兩個部分：尋道時間（Seek Time）和旋轉延遲（Rotational Latency）。尋道時間是指讀寫頭從當前位置移動到目標柱面的時間，而旋轉延遲是指磁碟旋轉過程中，直到所需數據達到讀寫頭的時間。

#### 5.4.2 磁碟排程策略

為了提高磁碟操作的效率，操作系統採用不同的磁碟排程算法來決定讀寫請求的執行順序。常見的磁碟排程算法包括：

- **先來先服務（First-Come, First-Served，FCFS）**：
  這是最簡單的排程算法，根據請求到達的順序執行。儘管FCFS容易實現，但它可能會導致磁碟臂在磁碟上來回移動，造成不必要的延遲，效率較低。

- **最短尋道時間優先（Shortest Seek Time First，SSTF）**：
  在每次選擇下一個請求時，SSTF選擇距離當前磁碟讀寫頭位置最近的請求。這樣可以減少磁碟臂的移動距離，提高效率。然而，SSTF可能會導致“饑餓”現象，即遠離當前位置的請求可能長時間無法得到服務。

- **電梯算法（Elevator Algorithm，也稱作SCAN算法）**：
  SCAN算法使磁碟讀寫頭像電梯一樣，從磁碟的一端掃描到另一端，當到達磁碟的最外圈或最內圈時，反向掃描。在每個掃描過程中，請求會按照其柱面位置被處理，類似於電梯的上下移動。這樣的方式能夠確保所有請求被公平地處理，避免了饑餓現象。

- **改進的電梯算法（C-SCAN）**：
  C-SCAN是對SCAN算法的改進，它限制讀寫頭的移動方向。當讀寫頭達到磁碟的一端時，它不會反向掃描，而是直接返回磁碟的另一端，再開始掃描。這樣可以保證請求在某一方向上得到更快的服務，並避免了反向掃描所帶來的額外等待。

- **最短尋道時間優先（LOOK）**：
  LOOK算法與SCAN算法類似，但它並不會掃描整個磁碟，而是在處理完最遠的請求後就停止掃描。具體來說，當讀寫頭接近磁碟的末端並且不再有請求時，算法會立即反向掃描。

- **循環掃描（C-LOOK）**：
  C-LOOK是對LOOK算法的改進，當掃描過程到達磁碟的末端，讀寫頭會直接跳轉到另一端，繼續掃描。這樣可以避免在掃描的過程中不必要的等待，並提高效率。

#### 5.4.3 排程算法比較

| 排程算法           | 優點                           | 缺點                           | 說明                                                         |
|-------------------|--------------------------------|--------------------------------|------------------------------------------------------------|
| FCFS              | 簡單易實現                    | 效率低，可能導致長時間的磁碟臂移動 | 不考慮距離，按到達順序處理請求                                   |
| SSTF              | 減少尋道時間                   | 可能導致饑餓現象               | 每次選擇最近的請求以最小化磁碟臂的移動距離                           |
| SCAN              | 高效，避免長時間等待            | 實現較為複雜，存在反向掃描的問題 | 類似電梯的運作，掃描磁碟一端到另一端後反向掃描                           |
| C-SCAN            | 更加公平，避免反向掃描的問題   | 需要額外的反向移動時間         | 當掃描到達一端後，直接返回另一端繼續掃描，避免反向掃描時間延遲                |
| LOOK              | 高效，減少無謂的掃描             | 複雜，可能存在死角             | 只掃描需要的範圍，避免掃描整個磁碟                                   |
| C-LOOK            | 減少無謂的等待和掃描           | 實現較為複雜                   | 類似LOOK，但返回時不掃描已處理的範圍，繼續從未處理的部分掃描                     |

#### 5.4.4 磁碟排程的應用與挑戰

- **應用場景**：磁碟排程在日常的操作系統管理中至關重要，尤其是在文件系統的讀寫操作、數據庫系統、大型應用程序中，磁碟的性能和排程策略對整體系統效能有直接影響。在多用戶系統中，良好的磁碟排程算法能夠提高整體系統響應時間。

- **挑戰**：隨著現代磁碟技術的發展，尤其是固態硬碟（SSD）的普及，磁碟排程的挑戰有所變化。SSD雖然不再依賴於磁碟臂的物理運動，但其內部的塊管理、寫入限制和資料保持特性仍然需要特別的考量。在此背景下，許多傳統的磁碟排程算法可能不再適用，操作系統需根據新硬體特性對排程策略進行調整。

#### 小結

磁碟排程是操作系統中提高I/O效能的重要技術之一。各種排程算法根據不同的需求和場景有著不同的優缺點。通過精心設計排程策略，可以大幅減少磁碟存取的延遲，提高系統的總體性能。隨著新型存儲設備的出現，磁碟排程技術也面臨新的挑戰，需要不斷調整和創新。