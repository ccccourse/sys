#### 2.6 即時排程

**即時排程（Real-Time Scheduling）** 是指在即時系統（Real-Time Systems）中，用來管理和分配處理器資源的排程方法。即時系統要求在確定的時間內完成特定任務，而這些任務往往具有硬性或軟性時間限制。即時排程的目標是確保高優先級任務能夠在其指定的時間範圍內完成，從而避免錯過時限，保證系統的可靠性和穩定性。

即時排程可分為兩類：
- **硬即時系統（Hard Real-Time Systems）**：系統中某些任務必須在確定的時間內完成，否則系統將會出現嚴重錯誤，甚至導致災難性後果。例如，飛行控制系統、心臟起搏器等。
- **軟即時系統（Soft Real-Time Systems）**：系統中的任務在大多數情況下都應該在指定的時間內完成，但偶爾錯過期限不會對系統產生嚴重影響。例如，視頻播放、音頻流媒體等。

##### 2.6.1 即時排程的要求

即時排程的核心需求是**時間約束**。根據時間約束的性質，常見的即時排程需求包括：
- **最長響應時間要求**（Maximum Response Time Requirement）：即任務必須在某一特定時間內開始或完成。
- **最短完成時間要求**（Minimum Completion Time Requirement）：即任務必須在某一特定時間內完成，並且這段時間越短越好。
- **周期性要求**（Periodic Requirements）：某些任務是周期性執行的，需要在每個週期內完成。

此外，即時系統通常有更高的可靠性要求，並且需要能夠處理多任務並發、資源競爭以及優先級反轉等問題。

##### 2.6.2 即時排程演算法

根據即時系統的特性，已有多種不同的排程演算法來確保即時性要求的滿足。最常見的即時排程演算法包括：

###### 2.6.2.1 固定優先級排程（Fixed Priority Scheduling）

在固定優先級排程中，每個任務都會被分配一個固定的優先級，並根據優先級來排定執行順序。常見的固定優先級排程演算法有：
- **最短截止時間優先（Earliest Deadline First, EDF）**：每次選擇截止時間最早的任務執行，這樣能夠保證所有任務按時完成，並且是最理想的排程策略，適用於許多硬即時系統。
  
- **優先級排序排程（Priority-Driven Scheduling）**：任務根據其優先級進行排序，優先級高的任務會先執行。該方法簡單有效，但可能會造成較低優先級任務的延遲。

- **循環優先級排程（Round Robin Scheduling）**：將進程按優先級分配時間片，並以循環的方式執行。適合於軟即時系統，能夠保證較高的系統吞吐量。

###### 2.6.2.2 動態優先級排程（Dynamic Priority Scheduling）

動態優先級排程演算法會根據任務的動態狀態來調整優先級。常見的動態優先級排程演算法有：
- **最短剩餘執行時間優先（Shortest Remaining Time First, SRTF）**：這是一種根據任務剩餘執行時間動態調整優先級的排程演算法。剩餘執行時間最短的任務會被優先執行，這有助於減少任務的總完成時間。

- **截止時間優先（Deadline-Driven Scheduling）**：根據任務的截止時間來調整其優先級，截止時間越短的任務優先執行。這可以確保所有任務按時完成，並且能夠適應動態變化的負載。

###### 2.6.2.3 雙重優先級排程（Two-Level Scheduling）

雙重優先級排程結合了固定優先級和動態優先級排程的特性。系統中每個任務會被分配一個靜態優先級，同時根據系統的需求和任務的狀態動態調整其優先級。這樣可以在確保即時性的同時，提升系統的效能。

##### 2.6.3 即時排程的挑戰

即時排程面臨多方面的挑戰，主要包括：

- **資源競爭**：多任務並發執行時，資源競爭可能會導致延遲，特別是對於硬即時系統，資源的共享和分配需謹慎設計。
  
- **優先級反轉**：當一個高優先級任務被低優先級任務所阻塞時，可能會導致系統錯過即時性要求。為了解決優先級反轉問題，許多系統使用優先級繼承（Priority Inheritance）或優先級封鎖（Priority Ceiling）技術來解決。

- **混合任務模型**：即時系統中的任務可能是混合型的，既有硬即時任務，也有軟即時任務。這要求作業系統能夠靈活地根據不同的任務特性進行調度。

- **多核心系統排程**：隨著多核心處理器的普及，即時排程需要考慮到如何在多個處理器之間有效地分配任務。這通常涉及到負載平衡、任務分配和通信的問題。

##### 2.6.4 即時排程的實際應用

即時排程在許多領域中都有應用，包括但不限於：

- **嵌入式系統**：例如自駕車、機器人、醫療設備等，這些系統需要即時處理來保證安全性和可靠性。
  
- **航太與航空領域**：飛行控制系統和衛星系統的操作需要即時反應。

- **通信系統**：例如語音通話、視頻會議等，這些應用對延遲有嚴格要求。

##### 小結

即時排程在多任務系統中扮演著至關重要的角色，特別是在需要保證時間敏感性和高可靠性的應用中。隨著即時系統需求的多樣化和技術的發展，作業系統需要靈活地選擇並實現不同的排程策略來應對各種挑戰。