### 4.3 檔案操作

檔案操作是檔案系統中的核心功能之一，讓使用者和應用程式能夠對檔案進行各種管理和處理。檔案操作包括檔案的創建、讀取、寫入、修改、刪除等基本操作，並且支援對檔案進行檢查、查詢和管理。操作檔案時，作業系統扮演著重要的角色，負責執行這些操作並確保資料的安全性和完整性。

#### 4.3.1 檔案的創建

檔案創建是使用者或應用程式將一個新檔案寫入磁碟或其他儲存設備的過程。當創建檔案時，作業系統會在檔案系統中為該檔案分配儲存空間，並記錄其元資料（如檔案名稱、位置、大小、創建時間等）。創建檔案的操作通常需要指定檔案名稱及其存儲位置。

- **檔案創建的過程**：
  1. 使用者發出創建檔案的命令。
  2. 作業系統檢查目錄中是否已經存在同名的檔案。
  3. 若無同名檔案，作業系統在檔案系統中為新檔案分配儲存空間，並創建對應的目錄項。
  4. 檔案的初始內容可以是空的，或由使用者進行填充。

創建檔案的命令通常為 `create` 或 `touch`（在 UNIX 類系統中）。在某些情況下，如果檔案已經存在，作業系統會根據設定進行處理（如覆蓋、保留舊檔案等）。

#### 4.3.2 檔案讀取與寫入

檔案讀取和寫入是檔案操作中最常見的動作，使用者或應用程式需要對檔案中的資料進行存取。讀取操作會將檔案中的資料載入到記憶體中，而寫入操作則會將記憶體中的資料寫入到檔案中。

- **檔案讀取**：讀取操作將檔案的內容從儲存設備載入到系統的記憶體中。作業系統會根據檔案的大小和存儲位置，管理資料的讀取過程。
  1. 使用者發出讀取命令，指定檔案名稱及所需讀取的範圍。
  2. 作業系統檢查檔案的存取權限，確認是否有讀取許可。
  3. 若有權限，作業系統將檔案內容從磁碟讀入記憶體，並將資料提供給應用程式。

- **檔案寫入**：寫入操作將資料從記憶體寫入檔案中，並可能會更新檔案的內容或增添新資料。
  1. 使用者發出寫入命令，指定檔案名稱及寫入的資料。
  2. 作業系統檢查檔案的存取權限，確認是否有寫入許可。
  3. 若有權限，作業系統會將資料寫入磁碟，並更新檔案的大小和修改時間等元資料。

檔案的讀寫可以是隨機的，也可以是順序的。隨機讀寫允許任意位置的資料存取，而順序讀寫則是依照一定的順序進行資料的存取。

#### 4.3.3 檔案修改

檔案的修改涉及到對檔案內容進行更動。這可以是修改現有資料、添加新資料或刪除原有資料。作業系統會在檔案修改時保持檔案的原有屬性，並在修改後更新檔案的元資料，如最後修改時間。

- **檔案修改的過程**：
  1. 使用者發出修改命令，指定檔案名稱和修改內容。
  2. 作業系統檢查檔案的存取權限，確保使用者有權進行修改操作。
  3. 作業系統將變更內容寫入磁碟，並更新檔案的元資料（如修改時間）。

在某些檔案系統中，修改操作可能會產生新的檔案版本，尤其是在支持版本控制的檔案系統中。

#### 4.3.4 檔案刪除

檔案刪除是將檔案從磁碟或其他儲存設備中移除的操作。當檔案被刪除時，作業系統會釋放檔案佔用的儲存空間，並從目錄中刪除該檔案的相關項目。

- **檔案刪除的過程**：
  1. 使用者發出刪除命令，指定檔案名稱。
  2. 作業系統檢查檔案的存取權限，確認使用者是否有刪除檔案的許可。
  3. 若有權限，作業系統會將檔案的資料從磁碟中刪除，並更新目錄結構，將檔案項目移除。

在某些情況下，作業系統可能會先將檔案移動到回收站或垃圾桶，直到使用者確認永久刪除。

#### 4.3.5 檔案重命名與移動

檔案的重命名和移動是檔案管理中的常見操作。重命名操作會修改檔案的名稱，而移動操作則是將檔案從一個目錄轉移到另一個目錄。

- **檔案重命名**：
  1. 使用者發出重命名命令，指定新的檔案名稱。
  2. 作業系統會修改檔案的名稱並更新目錄項。

- **檔案移動**：
  1. 使用者發出移動命令，指定新的儲存位置。
  2. 作業系統會將檔案從原位置移動到新位置，並在目標目錄中更新目錄結構。

#### 4.3.6 檔案存取控制

檔案操作的過程中，作業系統會通過存取控制來保護檔案的安全性。存取控制確保只有被授權的使用者或進程可以進行檔案操作。檔案的存取控制權限通常包括：

- **讀取權限**：允許使用者讀取檔案內容。
- **寫入權限**：允許使用者修改檔案內容。
- **執行權限**：允許使用者執行檔案（通常是程式檔案）。

作業系統通常會根據檔案的權限設置，通過存取控制清單（ACL）或使用者/群組權限來管理對檔案的存取。

#### 小結

檔案操作是作業系統的核心功能之一，為使用者提供了對檔案進行管理、存取、修改和刪除的能力。作業系統在處理這些操作時，不僅需要保證檔案的正確存取和修改，還需確保資料的安全性和完整性。透過檔案創建、讀取、寫入、刪除等操作，使用者能夠有效地管理系統中的資料和檔案。