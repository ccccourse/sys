#### 2.3 CPU 排程演算法

**CPU 排程（CPU Scheduling）** 是作業系統中一個關鍵的概念，其目的是有效管理 CPU 時間的分配，確保各個處理程序（或執行緒）公平且高效地獲得處理器資源。良好的 CPU 排程演算法能夠顯著提高系統性能，減少響應時間，並提高資源的使用效率。CPU 排程演算法的設計通常需要在以下方面取得平衡：

- **公平性**：確保所有進程或執行緒都有公平的機會獲得 CPU 時間。
- **效能**：最大化 CPU 的利用率，避免閒置。
- **響應時間**：減少進程的等待時間，特別是交互式應用。
- **周轉時間**：減少所有進程完成所需的總時間。

根據不同的策略和需求，CPU 排程演算法有許多種類。下面將介紹常見的 CPU 排程演算法及其特點。

##### 2.3.1 先來先服務（FCFS，First-Come, First-Served）

**先來先服務（FCFS）** 是最簡單的 CPU 排程演算法，根據進程到達的順序為其分配 CPU 時間。具體來說，最早到達的進程先獲得執行，當前進程完成後，才會開始執行下一個進程。

- **優點**：
  - 實現簡單，易於理解。
  - 沒有複雜的計算或資料結構。
- **缺點**：
  - 可能會導致**長進程阻塞短進程**（即“等待時間長”問題）。例如，若一個長時間運行的進程在隊列前端，後來的短進程必須等待長進程完成。
  - **平均等待時間**可能較長，尤其是在作業多樣化的情況下。

##### 2.3.2 最短作業優先（SJF，Shortest Job First）

**最短作業優先（SJF）** 是一種基於進程執行時間的排程策略。此演算法選擇當前執行隊列中需要最短執行時間的進程。換句話說，每次選擇預計運行時間最短的進程來執行。

- **優點**：
  - 在理論上，SJF 排程能夠實現最小的**平均等待時間**，因為短作業不會被長作業阻塞。
- **缺點**：
  - **預測執行時間**的困難：實際中很難精確預測進程所需的 CPU 時間。若無法準確預測，則難以實現這種排程。
  - 會導致**長作業飢餓**（Starvation），因為長時間運行的進程可能永遠無法執行，尤其是當系統中有大量短作業時。

##### 2.3.3 時間片輪轉（RR，Round Robin）

**時間片輪轉（RR）** 是一種基於時間片的排程演算法，每個進程在獲得 CPU 時間後，僅允許運行一個固定的時間片，然後切換到下個進程。如果進程在其時間片內完成，則會被終止；如果未完成，則會被移到隊列的末尾，並等待下一輪的處理。

- **優點**：
  - 這種演算法能夠保證各進程的公平性，並且適用於交互式系統，因為所有進程都能夠定期獲得處理器時間。
  - 系統的響應時間較快，尤其是在多數進程執行時間較短的情況下。
- **缺點**：
  - 如果時間片過長，則會變得像 FCFS 排程一樣；如果時間片過短，則會增加上下文切換的開銷，降低系統效能。
  - 無法保證最小的平均周轉時間，特別是在處理大量短作業時。

##### 2.3.4 優先級排程（Priority Scheduling）

**優先級排程（Priority Scheduling）** 是基於每個進程的優先級來進行排程的演算法。每個進程都有一個優先級值，作業系統會選擇優先級最高的進程來執行。此演算法可分為兩種類型：

1. **非搶占式優先級排程**：當高優先級的進程到達時，系統不會中斷當前執行的低優先級進程，而是等當前進程結束後再執行高優先級進程。
2. **搶占式優先級排程**：當高優先級的進程到達時，系統會立即中斷當前進程，並切換到高優先級進程。

- **優點**：
  - 有助於處理需要緊急執行的高優先級進程。
  - 可以根據進程的重要性和需求調整優先級。
- **缺點**：
  - **飢餓問題**：低優先級的進程可能永遠無法獲得 CPU 時間。
  - 確定進程的優先級可能存在困難，並且錯誤的優先級設定可能導致不公平的排程。

##### 2.3.5 多級反饋隊列（Multilevel Feedback Queue）

**多級反饋隊列（Multilevel Feedback Queue，MLFQ）** 是一種複合型的排程演算法，它將進程按照不同的優先級分配到不同的隊列中。每個隊列都有不同的時間片長度，並根據進程的行為進行動態調整。

- **基本原理**：進程最初被放入優先級較高的隊列中，若進程未在其時間片內完成，則會被移動到優先級較低的隊列中。進程在不同隊列中的優先級會根據其行為動態調整（例如，若進程長時間未使用 CPU，則可能上升至較高優先級隊列）。
- **優點**：
  - 結合了不同排程策略的優勢，既能公平分配 CPU 時間，又能處理優先級較高的進程。
  - 可以自動調整優先級，避免飢餓問題。
- **缺點**：
  - 排程機制較為複雜，需要管理多個隊列，並進行動態調整。

##### 2.3.6 比較與選擇

每種排程演算法都有其優缺點，選擇合適的排程演算法取決於具體的系統需求。一般來說，**時間片輪轉（RR）** 適合需要快速響應的交互式系統，**最短作業優先（SJF）** 更適合處理批量作業，而**優先級排程** 則適合需要考慮進程優先級的情境。**多級反饋隊列（MLFQ）** 則是一種較為靈活的選擇，適用於綜合需求的系統。

##### 小結

CPU 排程演算法是作業系統設計中的一個核心部分。每種排程策略都有其特定的應用場景和優缺點。在實際應用中，作業系統通常根據具體需求選擇或組合多種排程演算法，以達到最優的效能。