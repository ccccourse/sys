### 1.2 編譯器的工作流程

編譯器的工作流程通常可以分為幾個主要階段，每個階段負責完成特定的任務，並逐步將高階語言的源代碼轉換為可執行的機器碼。這些階段包括詞法分析、語法分析、語義分析、中間代碼生成、程式最佳化、目標代碼生成和連接（linking）。以下是編譯器工作流程的詳細步驟：

#### 1. 詞法分析（Lexical Analysis）
詞法分析是編譯過程的第一步。在這一階段，編譯器將源代碼拆解為一系列的詞法單元（token），這些單元是源代碼中具有語法意義的基本組成部分。

- **任務**：識別源代碼中的基本語法成分，如關鍵字、標識符、運算符和符號。
- **工具**：通常使用有限自動機來實現詞法分析器，典型工具如 Lex 或 Flex。
- **輸出**：生成一個詞法單元流，供後續語法分析階段使用。

#### 2. 語法分析（Syntax Analysis）
語法分析是將詞法分析生成的詞法單元流結構化為語法樹（或解析樹），該樹反映了源代碼的語法結構。

- **任務**：檢查源代碼的語法結構是否正確，並構建對應的語法樹。
- **工具**：常見工具有 Yacc 或 Bison。
- **輸出**：生成語法樹，提供給語義分析使用。

#### 3. 語義分析（Semantic Analysis）
語義分析確保語法樹符合語義規則，如類型檢查、變量範疇檢查和函數調用一致性檢查。

- **任務**：檢查語法樹中的語義錯誤，確保程式邏輯的一致性和正確性。
- **工具**：使用符號表來跟蹤變量和函數的信息。
- **輸出**：標註過的語法樹或抽象語法樹（AST）。

#### 4. 中間代碼生成（Intermediate Code Generation）
中間代碼生成將語法樹轉換為一種中間表示形式，這種表示介於高階語言和低階機器碼之間。

- **任務**：生成一種簡化的、機器無關的中間代碼，如三地址碼或 SSA。
- **輸出**：中間代碼，用於進一步的優化和代碼生成。

#### 5. 程式最佳化（Optimization）
最佳化階段旨在提升中間代碼的執行效率或減少資源消耗，分為局部最佳化和全域最佳化。

- **任務**：應用多種最佳化技術，如常量折疊、死代碼消除、迴圈優化等。
- **輸出**：優化後的中間代碼。

#### 6. 目標代碼生成（Code Generation）
目標代碼生成階段將優化後的中間代碼轉換為特定目標機器的機器碼。

- **任務**：選擇適當的機器指令、分配暫存器、進行指令排程。
- **輸出**：生成機器碼或可執行文件。

#### 7. 連接（Linking）
連接階段將不同模塊的目標代碼結合，並解決外部引用，使最終的可執行文件包含所有必要的代碼和數據。

- **任務**：連接目標文件、庫文件，解決符號引用，生成最終的可執行文件。
- **工具**：連接器（Linker）。

### 總結
編譯器的工作流程從詞法分析開始，逐步進行語法和語義檢查，生成中間代碼，進行最佳化，最後生成目標機器碼並連接成為可執行文件。每個階段都有特定的任務和輸出，確保最終生成的機器碼正確且高效。這一流程展示了編譯器如何將高階語言的源代碼轉換為機器可以理解和執行的形式，是現代軟體開發中的核心技術之一。