### 3.4 自底向上分析

自底向上分析（Bottom-up Parsing）是一種從語法樹的葉子節點（即終結符）開始進行語法分析的策略。在這種方法中，分析器會嘗試從輸入符號開始，將它們組合成更高層次的結構，最終構建出語法樹的根（即開始符號）。自底向上分析通常比自頂向下分析更具通用性，能夠處理更複雜的文法，特別是那些含有左遞歸的文法。

#### 1. 自底向上分析的基本過程

自底向上分析的核心思想是將輸入的終結符不斷地結合，生成語法樹的部分結構，直到整個語句的結構完全匹配文法規則為止。具體步驟如下：

1. **初始化**：從輸入的符號序列開始，這些符號可能是終結符或已經處理過的結構。
2. **歸約操作**：分析器會檢查當前的符號串，尋找是否存在某個產生式的右側匹配，將其替換為該產生式的左側（即歸約）。每次歸約後，語法樹的結構會向上構建。
3. **重複歸約**：這個過程會持續進行，直到所有的終結符都被處理完，且語法樹的根符號匹配文法的開始符。
4. **結束**：當所有的符號都被成功歸約並構建出一個完整的語法樹時，分析過程結束。

自底向上分析的過程像是逆向構建語法樹，逐步從葉子節點向根節點推進。

#### 2. 自底向上分析的例子

假設我們有以下文法規則：
```
E → E + T | T
T → T * F | F
F → ( E ) | id
```

並且我們要解析語句 `id + id * id`。

1. **開始分析**：從輸入 `id + id * id` 開始。首先匹配到第一個 `id`，這是終結符，根據文法規則 `F → id`，我們將其歸約為 `F`。
2. 接著匹配到 `+` 和 `id`，繼續進行歸約。第二個 `id` 會被歸約為 `F`，然後 `T` 會被生成，根據 `T → F`。
3. 然後，匹配到 `*` 和第三個 `id`，第三個 `id` 會被歸約為 `F`，並且進一步生成 `T`，再通過 `T → T * F` 將 `T` 擴展。
4. 最後，將整個結構歸約為 `E`。

語法樹的構建過程如下：
```
      E
     / \
    T   +
   / \    \
  F   *    T
 /          \
id           F
             |
            id
```

#### 3. 自底向上分析的類型

自底向上分析主要有兩種類型：**LR 分析**和**SLR 分析**，它們是自底向上分析中最常見的方法。

- **LR 分析（Left-to-right, Rightmost derivation）**：這是一種最強大的自底向上分析方法，它通過從左到右掃描輸入，並進行右最推導，能夠處理大多數上下文無關文法。LR 分析使用了一個稱為**狀態機**的結構來進行分析，並在每一步決定是執行移進還是歸約操作。
  
- **SLR 分析（Simple LR Parsing）**：SLR 分析是一種簡化版的 LR 分析。它對文法的要求比較嚴格，只能處理一些較為簡單的 LR(1) 文法。SLR 分析利用語法分析表來確定每步操作，並且使用少量的狀態來簡化計算過程。

#### 4. 自底向上分析的優缺點

**優點**：
1. **更強的表達能力**：自底向上分析能夠處理較為複雜的文法，包括含有左遞歸的文法，而這是自頂向下分析無法處理的。
2. **效率較高**：在許多情況下，自底向上分析能夠更有效率地解析複雜語法結構，尤其是那些結構較深的語句。

**缺點**：
1. **較為複雜**：與自頂向下分析相比，自底向上分析的實現較為複雜，尤其是對於大規模文法的支持，需要使用較為複雜的資料結構（例如分析堆疊、分析表）。
2. **回溯問題**：儘管自底向上分析的回溯問題相對較少，但在某些複雜的情況下，它仍然可能需要較長時間來選擇正確的歸約操作。

#### 5. 自底向上分析的實現方法

自底向上分析通常需要維護一個堆疊來追蹤當前處於哪個語法結構。在每一步中，分析器會從堆疊中彈出一部分結構，並檢查是否可以進行歸約操作。這通常會利用一個**分析表**來決定當前應該執行哪種操作。

例如，對於 LR 分析，分析表中會包含兩種操作：
- **移進（Shift）**：將當前輸入符號移入堆疊。
- **歸約（Reduce）**：根據當前堆疊中的符號，將其歸約為一個非終結符，並將非終結符推入堆疊。

分析表還包含狀態轉換的資訊，指示何時進行移進或歸約操作。

#### 6. 小結

自底向上分析是一種從終結符開始，逐步將它們組合成更高層次結構，最終構建完整語法樹的方法。這種方法能夠處理更為複雜的文法，特別是左遞歸文法，並且在效率上比自頂向下分析具有優勢。然而，自底向上分析實現起來較為複雜，並且在某些情況下可能需要回溯或較為複雜的資料結構來維護分析過程。