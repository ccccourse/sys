### 5.2 三地址碼

三地址碼（Three-Address Code, TAC）是一種中間表示形式，廣泛應用於編譯器中。它將高級語言的程序結構轉換為更簡單、易於操作的中間表示，並且使得編譯器在生成目標代碼之前能夠進行各種優化。三地址碼的主要特點是每一條指令通常由三個操作數組成，並且每條指令都代表一個簡單的操作，這使得它非常適合進行分析、優化以及生成目標代碼。

#### 基本結構

三地址碼的基本結構是：

```
result = operand1 operator operand2
```

- **result**：運算結果的位置，通常是變數或暫存器。
- **operand1, operand2**：參與運算的操作數，可以是變數、常量或其他計算的結果。
- **operator**：運算符，常見的有算術運算符（如加法、減法、乘法、除法），邏輯運算符（如與、或），比較運算符（如等於、不等於、大於等）等。

在這種形式下，指令中的每個運算都會被清楚地表達出來，並且每個指令都有明確的結果，這有助於在後續的編譯過程中進行優化和轉換。

#### 示例

假設有以下的高級語言代碼：

```c
a = b + c;
d = a * e;
f = d - g;
```

對應的三地址碼如下：

```
t1 = b + c      // 計算 b + c，將結果存入 t1
t2 = t1 * e     // 計算 t1 * e，將結果存入 t2
t3 = t2 - g     // 計算 t2 - g，將結果存入 t3
a = t1          // 將 t1 的值賦給變數 a
d = t2          // 將 t2 的值賦給變數 d
f = t3          // 將 t3 的值賦給變數 f
```

在這個例子中，每條三地址碼指令都表示一個簡單的運算，並且每個運算的結果都被存儲在一個暫時的變數（例如 `t1`, `t2`, `t3`）中，這樣的結構有利於後續的優化和目標代碼生成。

#### 特點

1. **簡單且直觀**：每條三地址碼指令的結構固定且簡單，易於理解。這使得編譯器的分析和優化過程更加簡便。
2. **抽象化**：三地址碼將源代碼的語法結構抽象為簡單的指令，去除了語言特有的複雜性，將源代碼轉換為與特定硬體無關的形式。
3. **便於優化**：三地址碼中的每條指令都相對簡單，這使得編譯器在優化過程中能夠輕鬆地進行各種優化，如死代碼消除、常量折疊等。
4. **支持中間代碼生成**：三地址碼是一種非常適合中間代碼生成的形式，許多現代編譯器使用三地址碼作為內部的中間表示，並在此基礎上進行各種處理。

#### 操作符

三地址碼中的操作符（operator）可分為多種類型，這些操作符根據操作數的性質和用途不同，具有不同的分類：

1. **算術運算符**：包括加法（`+`）、減法（`-`）、乘法（`*`）、除法（`/`）、取餘數（`%`）等。
   - 示例：`t1 = a + b`
2. **比較運算符**：用於比較兩個操作數的大小，結果通常是布爾值（`true` 或 `false`）。
   - 示例：`t1 = a < b`
3. **邏輯運算符**：包括邏輯與（`&&`）、邏輯或（`||`）、邏輯非（`!`）等。
   - 示例：`t1 = a && b`
4. **賦值運算符**：將一個操作數的值賦給另一個變數。
   - 示例：`a = t1`
5. **位運算符**：包括按位與（`&`）、按位或（`|`）、按位異或（`^`）、左移（`<<`）、右移（`>>`）等。
   - 示例：`t1 = a & b`

#### 優化

由於三地址碼指令結構簡單且清晰，它使得編譯器能夠對其進行多種優化操作，如：

- **常量折疊（Constant Folding）**：在編譯階段就計算常數表達式的結果。
  - 例如，`t1 = 5 + 3` 可以直接優化為 `t1 = 8`。
  
- **死代碼消除（Dead Code Elimination）**：去除從未被使用的計算或結果。
  - 例如，如果變數 `t1` 只被賦值但從未使用，則可以將這條指令刪除。

- **公共子表達式消除（Common Subexpression Elimination）**：如果一個表達式在多個地方出現，則可以將其結果存儲在暫時變數中，避免重複計算。
  - 例如，如果 `t1 = a + b` 和 `t2 = a + b` 出現多次，則可以將其合併成 `t1 = a + b` 和 `t2 = t1`。

#### 小結

三地址碼作為編譯過程中的中間表示形式，不僅能夠簡化代碼結構，還能夠有效支持各種編譯優化技術。它的簡單和直觀特性使得編譯器可以輕鬆進行各種分析和優化操作，因此被廣泛應用於現代編譯器的設計中。