### 2.2 加法器與減法器設計

#### 加法器設計

加法器是數位電路中最基本的運算單元之一，用於對二進位數字進行加法運算。基本的加法器可以分為 **半加器** 和 **全加器** 兩種類型：

1. **半加器（Half Adder）**：用於加兩個單位二進位數字，輸出一個和（Sum）和一個進位（Carry）。它不考慮外部的進位。
   
2. **全加器（Full Adder）**：用於加三個二進位數字，包含兩個加數和一個外部進位。全加器的輸出同樣包括和（Sum）和進位（Carry）。

全加器是由兩個半加器組合而成，並且處理來自上一位的進位。這裡我們將設計全加器，並且擴展到多位加法器來加兩個多位二進位數字。

##### 1. 真值表（Full Adder）：

| A | B | Cin | Sum | Cout |
|---|---|-----|-----|------|
| 0 | 0 |  0  |  0  |   0  |
| 0 | 0 |  1  |  1  |   0  |
| 0 | 1 |  0  |  1  |   0  |
| 0 | 1 |  1  |  0  |   1  |
| 1 | 0 |  0  |  1  |   0  |
| 1 | 0 |  1  |  0  |   1  |
| 1 | 1 |  0  |  0  |   1  |
| 1 | 1 |  1  |  1  |   1  |

- **A** 和 **B** 是加數位。
- **Cin** 是進位輸入（Carry-in）。
- **Sum** 是加法結果。
- **Cout** 是進位輸出（Carry-out）。

##### 2. Verilog 程式碼（全加器）

```verilog
module FullAdder (
    input wire A,     // 輸入 A
    input wire B,     // 輸入 B
    input wire Cin,   // 進位輸入
    output wire Sum,  // 和
    output wire Cout  // 進位輸出
);
    // 和的計算：A XOR B XOR Cin
    assign Sum = A ^ B ^ Cin;

    // 進位的計算：進位有兩種情況，A 和 B 為 1 或者 A 和 Cin 為 1 或者 B 和 Cin 為 1
    assign Cout = (A & B) | (A & Cin) | (B & Cin);
endmodule
```

### 程式碼解釋：
1. **`FullAdder` 模組**：此模組代表全加器，輸入包括 `A`、`B` 和 `Cin`（進位輸入），輸出包括 `Sum`（和）和 `Cout`（進位輸出）。
   
2. **和（`Sum`）計算**：我們使用 XOR 閘計算 `Sum`。由於加法運算涉及進位，因此 `Sum` 的公式是：`Sum = A XOR B XOR Cin`。這表示當 A、B 和 Cin 中的奇數個為 1 時，`Sum` 為 1。

3. **進位（`Cout`）計算**：進位的輸出是由三個條件產生的：如果 `A` 和 `B` 都為 1，或者 `A` 和 `Cin` 都為 1，或者 `B` 和 `Cin` 都為 1，則進位為 1。這可以通過 `Cout = (A & B) | (A & Cin) | (B & Cin)` 計算出。

#### 多位加法器設計（加法器鏈）

如果我們需要對多個二進位數字進行加法，可以使用全加器鏈式結構。每個加法器的進位輸出會作為下一位加法器的進位輸入。以下是兩個 4 位數字加法的設計：

##### 1. 真值表（4 位加法器）：

| A3 | A2 | A1 | A0 | B3 | B2 | B1 | B0 | Cin | Sum3 | Sum2 | Sum1 | Sum0 | Cout |
|----|----|----|----|----|----|----|----|-----|------|------|------|------|------|
|  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0  |   0  |   0  |   0  |   0  |   0  |
|  1 |  0 |  0 |  0 |  1 |  0 |  0 |  0 |  0  |   1  |   0  |   0  |   0  |   0  |
|  1 |  0 |  0 |  0 |  1 |  0 |  0 |  1 |  0  |   0  |   1  |   0  |   0  |   0  |

在這個真值表中，`Sum3` 到 `Sum0` 代表每一位的和，`Cout` 是最終的進位。

##### 2. Verilog 程式碼（4 位加法器）

```verilog
module FourBitAdder (
    input wire [3:0] A,      // 4位數字A
    input wire [3:0] B,      // 4位數字B
    input wire Cin,          // 進位輸入
    output wire [3:0] Sum,   // 4位和
    output wire Cout         // 進位輸出
);
    wire C1, C2, C3; // 中間進位

    // 每一位的加法器
    FullAdder FA0 (.A(A[0]), .B(B[0]), .Cin(Cin), .Sum(Sum[0]), .Cout(C1));
    FullAdder FA1 (.A(A[1]), .B(B[1]), .Cin(C1), .Sum(Sum[1]), .Cout(C2));
    FullAdder FA2 (.A(A[2]), .B(B[2]), .Cin(C2), .Sum(Sum[2]), .Cout(C3));
    FullAdder FA3 (.A(A[3]), .B(B[3]), .Cin(C3), .Sum(Sum[3]), .Cout(Cout));

endmodule
```

### 程式碼解釋：
1. **`FourBitAdder` 模組**：此模組設計了一個 4 位的加法器，接受兩個 4 位的二進位數字 `A` 和 `B`，並且計算它們的和和進位。

2. **中間進位（C1, C2, C3）**：由於每個全加器的進位會影響下一個加法器的計算，因此我們需要使用中間進位來鏈接每個加法器。

3. **全加器實例**：在這個模組中，我們實例化了四個 `FullAdder`，並將它們依次連接。每個加法器的進位輸入來自上一位的進位輸出。

#### 減法器設計

減法器的設計與加法器相似，但它需要處理二進位的減法。減法器可以基於加法器設計，利用補數運算來實現。

##### 1. 完全差值器（Full Subtractor）：

類似全加器，全減法器處理兩個二進位數字及一個外部借位（Borrow-in）來進行減法。其公式為：

- **Difference = A XOR B XOR Bin**
- **Borrow = (NOT A AND B) OR (NOT A AND Bin) OR (B AND Bin)**

##### 2. Verilog 程式碼（全減法器）

```verilog
module FullSubtractor (
    input wire A,     // 輸入 A
    input wire B,     // 輸入 B
    input wire Bin,   // 借位輸入
    output wire Diff, // 差值
    output wire Bout  // 借位輸出
);
    // 差值計算：A XOR B XOR Bin
    assign Diff = A ^ B ^ Bin;

    // 借位計算：借位有三種情況，A為0且B為1，A為0且Bin為1，B為1且Bin為1
    assign Bout = (~A & B) | (~A & Bin) | (B & Bin);
endmodule
```

#### 設計意義與原理：
- **加法器與減法器設計**：加法器和減法器是數位電路中的基本組件，它們執行的是算術運算。加法器基於 XOR 和 AND 運算，而減法器則基於 XOR 和 NOT、AND 運算實現二進位補數運算。
  
- **加法器鏈設計**：在多位加法器中，我們利用全加器鏈將每位的計算和進位連接起來。這樣的設計可以處理任意位數的二進位加法。

- **減法器設計**：減法器利用借位的概念來處理數字減法。通過進行補數運算，我們可以使用加法器來計算減法。

### 結論：
加法器和減法器是數位系統中的基本組件，通常用來實現算術運算。這些元件的設計不僅基於布林代數的邏輯運算，也利用了電路的簡單組合來處理更複雜的運算。在實際應用中，這些基本元件被組合起來，構成更複雜的數位處理單元，如 ALU（算術邏輯單元）和 CPU（中央處理單元）。