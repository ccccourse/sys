### 5.6 RAID 系統

RAID（Redundant Array of Independent Disks，冗餘磁碟陣列）是一種將多個硬碟組合在一起，來提高存儲系統性能、擴充容量及可靠性的方法。RAID 系統主要通過不同的資料分佈與冗餘方式來實現資料的高效存儲與保護。RAID 技術廣泛應用於伺服器、數據中心和高效能計算系統中，能有效提升資料存取速率，並保證在單一硬碟損壞的情況下資料不會丟失。

### RAID 主要級別

RAID 擁有多種配置，每一種配置（或稱為 RAID 級別）提供不同的性能和容錯能力。以下是幾個常見的 RAID 級別：

1. **RAID 0（條帶化）**：
   - **特性**：RAID 0 通過條帶化技術將資料分佈於多個硬碟中，增加資料的讀寫速率。
   - **優點**：最佳性能，沒有任何磁碟空間浪費，因為所有的容量都用於存儲資料。
   - **缺點**：沒有冗餘機制，如果任何一個磁碟故障，整個系統的資料都會丟失。
   - **最適用**：需要極高性能的情境，如視頻編輯、大型數據處理等。

2. **RAID 1（鏡像）**：
   - **特性**：RAID 1 將資料完全鏡像到兩個或更多的硬碟上，保證資料有一個副本存在。
   - **優點**：資料冗餘，提供資料保護。若一個硬碟損壞，系統仍能繼續運行，資料不會丟失。
   - **缺點**：存儲容量只有一半有效，因為每一個硬碟都存儲相同的資料。
   - **最適用**：需要高資料可靠性的情況，如金融、醫療等需要保證資料完整性的行業。

3. **RAID 5（條帶化與奇偶校驗）**：
   - **特性**：RAID 5 在條帶化的基礎上加入奇偶校驗，將奇偶校驗資料分佈於所有硬碟中。這樣即使其中一個硬碟損壞，仍可以根據其餘硬碟和奇偶校驗資料來重建丟失的資料。
   - **優點**：提供資料冗餘和性能的平衡。相對於 RAID 1，RAID 5 用戶可獲得更多的有效存儲容量。
   - **缺點**：寫入性能較差，因為每次寫入都需要計算和更新奇偶校驗資料。
   - **最適用**：對於需要高可用性和較高容量的應用，常見於企業級應用。

4. **RAID 6（條帶化與雙重奇偶校驗）**：
   - **特性**：RAID 6 基本上是 RAID 5 的擴展，增加了第二層奇偶校驗資料。這樣，即使有兩個硬碟同時損壞，資料仍然可以重建。
   - **優點**：提供更高的容錯性，最多可允許兩個硬碟損壞而不會丟失資料。
   - **缺點**：需要更多的存儲空間來存放雙重奇偶校驗資料，相較於 RAID 5，其寫入性能會更低。
   - **最適用**：需要高度容錯的應用，如大型數據中心、雲端存儲等。

5. **RAID 10（RAID 1 + RAID 0）**：
   - **特性**：RAID 10 是 RAID 1 和 RAID 0 的組合，將資料鏡像並進行條帶化。這提供了 RAID 1 的冗餘性和 RAID 0 的性能。
   - **優點**：結合了高性能和高冗餘性，提供更好的讀寫性能並保護資料。
   - **缺點**：需要至少四個硬碟，且存儲效率較低，因為資料會鏡像存儲。
   - **最適用**：對性能和可靠性要求高的應用，如資料庫伺服器、虛擬化環境等。

6. **RAID 50 和 RAID 60**：
   - **特性**：RAID 50 是 RAID 5 和 RAID 0 的組合，RAID 60 是 RAID 6 和 RAID 0 的組合，這兩種配置提供了更高的性能和容錯能力。
   - **優點**：它們綜合了條帶化、奇偶校驗和冗餘，提供了較好的效能和較高的資料保護。
   - **缺點**：需要更多的硬碟，且相對於 RAID 5 和 RAID 6，成本較高。
   - **最適用**：需要更高效能的容錯存儲系統，如大規模的數據庫和企業級存儲解決方案。

### RAID 系統的 Linux 實作

在 Linux 中，RAID 系統的實作通常依賴於軟體 RAID 技術，這通常是通過 **mdadm** 工具來實現的。`mdadm` 是 Linux 下用來創建、管理和維護軟體 RAID 的命令行工具。

#### 創建 RAID 1 (鏡像)

假設你有兩個磁碟 `/dev/sda` 和 `/dev/sdb`，並希望創建一個 RAID 1 陣列。首先，你需要安裝 `mdadm` 工具：

```bash
sudo apt-get install mdadm
```

然後，使用以下命令創建 RAID 1 陣列：

```bash
sudo mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sda /dev/sdb
```

這會創建一個名為 `/dev/md0` 的 RAID 1 陣列，包含兩個磁碟 `/dev/sda` 和 `/dev/sdb`。

#### 查看 RAID 陣列狀態

使用 `cat` 命令查看 RAID 陣列的狀態：

```bash
cat /proc/mdstat
```

這將顯示當前 RAID 陣列的狀態，是否正常運行，是否有硬碟故障等信息。

#### 添加更多硬碟到 RAID 陣列

如果需要向 RAID 陣列添加更多磁碟，可以使用以下命令：

```bash
sudo mdadm --add /dev/md0 /dev/sdc
```

這會將新硬碟 `/dev/sdc` 添加到現有的 RAID 1 陣列中。

#### 擴展 RAID 1 陣列

如果想擴展 RAID 1 陣列以增加容量，可以使用以下命令：

```bash
sudo mdadm --grow /dev/md0 --raid-devices=3
```

這會將 RAID 1 陣列擴展為包含三個硬碟。

### RAID 配置的效能與容錯性

- **性能**：RAID 0 提供最佳性能，特別適合大規模讀寫操作，但缺乏冗餘性；RAID 10 和 RAID 5 提供性能和冗餘的平衡。
- **冗餘性**：RAID 1、RAID 5、RAID 6 和 RAID 10 都提供不同級別的資料保護，RAID 6 提供最強的容錯能力。
- **擴展性**：RAID 5 和 RAID 6 通常提供比 RAID 1 更高的存儲效率和可擴展性，而 RAID 10 則適合對高性能有需求的環境。

### 在 RISC-V 上使用 RAID

在 RISC-V 上使用 RAID，尤其是在嵌入式系統或虛擬化環境中，RAID 系統可以使用 Virtio 等技術來進行磁碟 I/O 操作。這些技術提供了高效的磁碟操作，並能支持 RAID 排程和容錯策略，保證數據的可靠性和性能。