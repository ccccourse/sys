### 4.2 目錄結構

在檔案系統中，目錄（Directory）是一種特殊的檔案，用來組織和管理其他檔案和目錄。目錄結構決定了檔案的層次化組織方式，這使得使用者可以以類似樹狀結構的方式來組織資料。目錄結構不僅便於資料的管理和搜尋，也可以根據需求設計不同的存取控制和權限。

#### 1. 目錄的基本概念

目錄是一個特殊的檔案，與普通檔案不同，它不包含實際的資料，而是包含對其他檔案或目錄的參照（即檔案名稱和它們在磁碟上的位置）。在目錄結構中，目錄可以包含其他目錄，形成層次化的組織結構。

**目錄的基本屬性**：
- **目錄名稱**：每個目錄都有一個唯一的名稱，並且每個目錄內的檔案和子目錄的名稱也是唯一的。
- **目錄項（Directory Entry）**：目錄內的每個條目通常包含檔案名稱及其對應的磁碟位置（或inode）。對於子目錄，目錄項會指向子目錄所在的位置。

#### 2. 目錄結構的種類

目錄結構的設計有多種方式，不同的作業系統和檔案系統可能會選擇不同的結構來組織檔案。常見的目錄結構包括：

- **單層結構（Flat Structure）**：
  在單層結構中，所有檔案都位於同一個目錄中。這種結構簡單，但不適用於檔案數量龐大的情況，因為檔案的搜尋、管理和存取會變得困難。
  
  例如：
  ```
  /home/user/file1.txt
  /home/user/file2.txt
  ```

- **層次結構（Hierarchical Structure）**：
  在層次結構中，目錄可以包含子目錄，這些子目錄又可以包含更多的子目錄或檔案。這種結構非常適合用於管理大量檔案，並且可以清晰地將檔案分類。
  
  例如：
  ```
  /home/user/
            ├── documents/
            │     └── file1.txt
            └── images/
                  └── img1.jpg
  ```

- **樹狀結構（Tree Structure）**：
  樹狀結構是層次結構的一種形式，強調目錄和檔案間的層級關係。根目錄是樹的起點，其他目錄和檔案作為樹的分支，層級清晰。
  
  例如：
  ```
  /
  ├── bin/
  ├── etc/
  ├── home/
  └── var/
  ```

#### 3. 目錄的操作

目錄本身也是檔案系統的一部分，並且可以像檔案一樣執行某些操作。常見的目錄操作包括：

- **創建目錄（mkdir）**：創建一個新目錄。
  ```bash
  mkdir new_directory
  ```

- **刪除目錄（rmdir）**：刪除一個空的目錄。
  ```bash
  rmdir empty_directory
  ```

- **列出目錄內容（ls）**：列出目錄中的檔案和子目錄。
  ```bash
  ls /home/user/
  ```

- **改變工作目錄（cd）**：改變當前工作目錄，進入另一個目錄。
  ```bash
  cd /home/user/documents
  ```

- **移動或重命名目錄（mv）**：將目錄移動到另一位置，或者改變目錄名稱。
  ```bash
  mv old_directory new_directory
  ```

#### 4. 目錄的元資料（Metadata）

每個目錄都有其元資料，這些元資料管理了目錄內檔案的索引信息。常見的元資料有：

- **inode**：每個目錄和檔案都有一個inode（Index Node），它是一個結構體，包含有關檔案或目錄的所有元數據（例如檔案大小、許可權、擁有者、檔案位置等）。對於目錄來說，inode中包含目錄的元資料以及指向目錄項的鏈接。

- **許可權與擁有者**：目錄會有與檔案類似的許可權設置，這些許可權控制誰可以讀、寫或執行該目錄內的檔案。目錄的擁有者可以是用戶、群組或系統。

#### 5. Linux 目錄結構範例

在 Linux 系統中，根目錄（`/`）是所有目錄結構的起點。常見的 Linux 目錄結構如下：

- **`/bin`**：存放基本的執行檔，如常用的系統命令（`ls`、`cp` 等）。
- **`/etc`**：系統配置檔案，存放系統全域的設置和參數。
- **`/home`**：用戶的主目錄，每個用戶都有一個子目錄（例如 `/home/user`）。
- **`/var`**：存放可變資料，如日誌檔案和郵件資料。
- **`/tmp`**：存放臨時檔案，系統和應用程式的暫存資料。

#### 6. C 語言範例：目錄操作

以下是使用 C 語言操作目錄的簡單範例：

```c
#include <stdio.h>
#include <stdlib.h>
#include <dirent.h>

int main() {
    struct dirent *entry;
    DIR *dp;

    // 打開目錄
    dp = opendir("/home/user");
    if (dp == NULL) {
        perror("opendir");
        return 1;
    }

    // 列出目錄內容
    while ((entry = readdir(dp)) != NULL) {
        printf("Name: %s\n", entry->d_name);
    }

    // 關閉目錄
    closedir(dp);
    return 0;
}
```

#### 7. 結論

目錄結構是檔案系統的重要組成部分，它提供了一種層次化的方式來管理檔案。目錄不僅能夠有效組織資料，還能夠對資料進行許可權管理，確保資料的安全性。了解和使用目錄操作指令和 C 語言的 API 可以幫助我們更高效地管理檔案系統中的資料。