### 4.2 順序邏輯電路設計

順序邏輯電路與組合邏輯電路的主要區別在於，順序邏輯電路的輸出不僅取決於當前的輸入，還取決於其過去的狀態。這意味著順序邏輯電路包含記憶元件，能夠“記住”先前的狀態。因此，順序邏輯電路能夠處理時間相關的訊息，例如計數器、計時器、狀態機等。

在設計順序邏輯電路時，設計師需要考慮以下要素：

1. **狀態**：順序邏輯電路有一個或多個狀態。這些狀態根據輸入和過去的狀態進行轉換。
2. **時序**：順序邏輯電路的行為依賴於時鐘信號。通常，電路會根據時鐘信號的上升沿或下降沿來更新其狀態。
3. **記憶元件**：順序邏輯電路依賴於記憶元件（如觸發器、寄存器等）來保存狀態信息。
4. **轉換規則**：根據目前的輸入和狀態，定義如何從一個狀態轉換到另一個狀態。

### 設計流程

設計順序邏輯電路通常包含以下步驟：

1. **定義問題**：明確電路的目標和功能需求，例如，設計一個計數器、有限狀態機等。
2. **建立狀態圖或狀態表**：根據需求，設計並確定電路的所有可能狀態，並定義各狀態之間的轉換規則。
3. **選擇記憶元件**：根據狀態需求，選擇適當的記憶元件，如觸發器、寄存器等。
4. **寫出邏輯方程式**：基於狀態轉換規則，利用邏輯方程式或布林代數，設計控制信號。
5. **實現電路**：將設計轉化為具體的硬體電路，並用硬體描述語言（如Verilog）實現。

### Verilog 程式碼：設計一個4位計數器

以下是一個簡單的 4 位二進制計數器的 Verilog 程式碼，它根據時鐘信號進行遞增，並在達到最大值後重置。

#### 4位計數器設計

```verilog
module Counter (
    input wire clk,       // 時鐘信號
    input wire reset,     // 重置信號
    output reg [3:0] count // 4位計數器輸出
);

    // 計數器邏輯
    always @(posedge clk or posedge reset) begin
        if (reset)              // 當reset為1時，計數器重置
            count <= 4'b0000;    // 設置計數器為0
        else
            count <= count + 1; // 每次時鐘上升沿，計數器加1
    end

endmodule
```

### 程式碼解釋：

1. **模組定義**：
    - 我們定義了一個名為 `Counter` 的模組，包含三個端口：`clk`（時鐘信號）、`reset`（重置信號）、`count`（4位計數器的輸出）。
    - 計數器是由 `reg [3:0] count` 實現的，它保存計數器的當前狀態。

2. **always 塊**：
    - 我們使用 `always` 塊來描述順序邏輯電路。這個塊會在時鐘信號的上升沿（`posedge clk`）或者重置信號的上升沿（`posedge reset`）觸發。
    - 如果 `reset` 為1，計數器會重置（`count <= 4'b0000`），將 `count` 設置為 0。
    - 如果 `reset` 為 0，則每當時鐘信號的上升沿到來時，計數器會加 1（`count <= count + 1`）。

3. **計數器邏輯**：
    - 當 `reset` 信號為 1 時，計數器會被重置，並且 `count` 的值設置為 4 位的 0 (`4'b0000`)。
    - 當 `reset` 為 0 時，計數器會在每個時鐘周期遞增1，直到達到最大值 15（`4'b1111`），然後會從 0 開始重新計數。

4. **`<=` 非阻塞賦值**：
    - 在 Verilog 中，我們使用 `<=` 來進行非阻塞賦值。這意味著，對 `count` 的賦值不會立即生效，而是等到 `always` 塊結束後再執行。這有助於避免競爭條件，確保計數器在每個時鐘週期內只更新一次。

### 設計意義與原理：

- **順序邏輯電路的核心是狀態機制**，在本例中，計數器的狀態是其數值（`count`）。計數器每次在時鐘的上升沿更新其狀態，並且根據重置信號的狀態決定是否重置。
- 計數器是數位系統中非常常見的元件，能夠記錄時間、計數事件或提供其他基於時間的功能。在本例中，計數器在每個時鐘周期內遞增，並且能夠在達到最大值後重置。
- 設計中的關鍵在於選擇合適的記憶元件（如此處的 `reg`）來存儲狀態，以及利用時鐘信號來確保計數器在每個時鐘周期更新。

### 結論：

順序邏輯電路的設計使得電路可以記住狀態，這是組合邏輯電路所無法實現的。設計如計數器這樣的順序邏輯電路能夠實現許多時間相關的功能，並且在許多數位系統中扮演著核心角色。在此例中，我們使用 Verilog 實現了一個簡單的 4 位計數器，並探討了如何使用時鐘和重置信號來控制計數器的行為。