以下是 **第3章 順序邏輯** 中 **3.4 有限狀態機** 的詳細內容：

---

### 3.4 有限狀態機（Finite State Machine, FSM）

有限狀態機（FSM）是順序邏輯設計中的核心概念之一，廣泛應用於數位系統中，負責處理基於當前狀態做出決策或轉換的行為。它的基本原理是將系統的操作限制在有限個可能的狀態中，並且系統的輸出和下一個狀態由當前狀態和輸入共同決定。有限狀態機是一種數位邏輯電路模型，常用來描述具有特定狀態和轉換規則的系統。

#### 3.4.1 有限狀態機的基本概念

有限狀態機由一組「狀態」和狀態之間的「轉換」所構成。在任意時間，有限狀態機都處於一個特定的狀態。隨著外部輸入的變化，有限狀態機可以根據預設的規則從一個狀態轉換到另一個狀態。有限狀態機的工作過程主要由以下三個元素組成：

1. **狀態（States）**：有限狀態機可以處於的不同情況或條件。每一個狀態代表了系統的某一個特定狀態。例如，在交通信號燈的有限狀態機中，可能的狀態包括紅燈、黃燈和綠燈。
   
2. **輸入（Inputs）**：外部信號或事件，會影響狀態機的行為。輸入通常是二進制信號或其他數位信號，這些信號會驅動狀態轉換。

3. **轉換（Transitions）**：狀態之間的變化規則。轉換依賴於當前狀態和外部輸入的組合，當滿足某些條件時，狀態機就會根據這些規則從一個狀態轉移到另一個狀態。

4. **輸出（Outputs）**：根據當前狀態和輸入決定的結果。輸出可以是系統的行為或反應，也可能是影響其他部分的信號。

#### 3.4.2 有限狀態機的類型

根據狀態轉換規則和輸出定義，有限狀態機可以分為兩大類型：**Mealy型有限狀態機**（Mealy Machine）和**Moore型有限狀態機**（Moore Machine）。

##### 1. Mealy型有限狀態機
在Mealy型有限狀態機中，輸出不僅取決於當前狀態，還取決於當前的輸入。這意味著，當輸入改變時，輸出可能會立即改變，即使狀態沒有發生變化。

- **狀態轉換**：當前狀態和輸入共同決定下一個狀態。
- **輸出**：當前狀態和輸入共同決定輸出。

**Mealy型有限狀態機的優點**：
- 輸出變化迅速，能夠反映當前輸入的變化。
- 相對於Moore型，通常需要較少的狀態數。

**Mealy型有限狀態機的缺點**：
- 輸出容易變得複雜，因為它同時依賴於狀態和輸入。

##### 2. Moore型有限狀態機
在Moore型有限狀態機中，輸出僅依賴於當前狀態，與當前的輸入無關。也就是說，當系統處於某一狀態時，輸出是固定的，只有狀態發生變化時，輸出才會改變。

- **狀態轉換**：當前狀態和輸入共同決定下一個狀態。
- **輸出**：僅由當前狀態決定。

**Moore型有限狀態機的優點**：
- 輸出邏輯簡單，易於設計和理解。
- 輸出不會直接受外部輸入影響，降低了輸出波動性。

**Moore型有限狀態機的缺點**：
- 輸出更新較慢，無法迅速反映外部輸入的變化。

#### 3.4.3 有限狀態機的設計步驟

設計有限狀態機的過程可以分為以下幾個基本步驟：

1. **定義狀態**：
   確定系統所需的所有可能狀態。在設計有限狀態機時，首先需要明確系統中所涉及的所有狀態，並為每個狀態分配一個唯一的標識符。這些狀態通常是基於系統的不同工作階段來定義的。

2. **建立狀態轉換圖**：
   繪製狀態轉換圖，該圖顯示了系統在各種輸入條件下從一個狀態轉換到另一個狀態的規則。狀態轉換圖通常用有向圖來表示，其中每個節點代表一個狀態，每條邊代表狀態之間的轉換。

3. **定義輸入與輸出**：
   確定系統的外部輸入和相應的輸出。根據Mealy型或Moore型FSM的要求，確定輸出是僅依賴狀態還是依賴於狀態和輸入。

4. **選擇適合的狀態編碼**：
   為每個狀態分配二進制編碼。這通常是將每個狀態映射到一個二進制數字，並根據需要進行狀態編碼的選擇。狀態編碼的選擇會影響後續的邏輯設計。

5. **實現狀態轉換邏輯**：
   使用邏輯閘、觸發器等元件實現狀態之間的轉換。狀態轉換邏輯通常是基於當前狀態和輸入來決定下一個狀態。

6. **實現輸出邏輯**：
   設計輸出邏輯，根據狀態和/或輸入決定輸出。對於Mealy型FSM，輸出邏輯依賴於當前狀態和輸入；對於Moore型FSM，輸出僅依賴於當前狀態。

7. **驗證設計**：
   通過模擬、測試和驗證來檢查有限狀態機的設計是否符合預期的功能要求。

#### 3.4.4 有限狀態機的應用

有限狀態機的應用非常廣泛，幾乎在所有數位系統中都能見到其身影。以下是一些典型的應用：

- **交通信號燈控制系統**：
  交通信號燈系統通常是一個典型的有限狀態機。每個信號燈的顏色（紅燈、黃燈、綠燈）代表不同的狀態，根據時間和交通流量，信號燈會根據轉換規則在不同的狀態之間切換。

- **數位計算機中的控制單元**：
  在計算機的控制單元中，有限狀態機用於根據當前指令和狀態來決定下一步的操作。例如，根據指令的不同，控制單元可能需要讀取、執行或存儲資料。

- **通信協議**：
  許多通信協議使用有限狀態機來控制訊號的發送和接收過程。每個狀態表示一個協議步驟，狀態之間的轉換對應於協議的各種操作。

- **儀器儀表與測試設備**：
  在許多測試設備和儀器中，有限狀態機用於控制設備的不同測量模式或操作階段。這些設備根據外部輸入進行狀態轉換，並執行相應的動作。

#### 3.4.5 小結

有限狀態機（FSM）是數位系統中至關重要的設計工具，能夠有效地描述和控制基於不同輸入和狀態的系統行為。根據不同的需求，設計者可以選擇使用Mealy型或Moore型有限狀態機。有限狀態