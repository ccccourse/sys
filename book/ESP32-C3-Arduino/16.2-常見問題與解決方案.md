### 16.2 **常見問題與解決方案**

在開發 ESP32-C3 應用時，您可能會遇到一些常見的問題，這些問題可能會影響程式的執行、效能或系統穩定性。本節將介紹一些常見的問題以及如何解決這些問題，幫助您在開發過程中迅速排除故障。

---

### 1. **Wi-Fi 連接失敗**

#### 問題描述：
ESP32-C3 在連接 Wi-Fi 時，可能會遇到無法成功連接到網絡的情況。這通常與網絡配置、Wi-Fi 設定或程式邏輯有關。

#### 可能的解決方案：
- **確認網絡設定**：檢查您的 SSID 和密碼是否正確，確保沒有錯誤的字符或空格。
- **檢查 Wi-Fi 頻段**：ESP32-C3 支援 2.4GHz Wi-Fi 頻段，請確認您的路由器設置是否使用了該頻段。ESP32-C3 不支援 5GHz 頻段。
- **檢查 IP 配置**：確保 ESP32-C3 沒有配置靜態 IP，或者 DHCP 服務正常運行。
- **使用 `WiFi.begin()` 前先重啟 ESP32-C3**：有時候在網絡環境變化的情況下，重新啟動設備可以解決連接問題。

```cpp
WiFi.begin(ssid, password);
while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi...");
}
Serial.println("Connected to WiFi");
```

---

### 2. **藍牙連接問題**

#### 問題描述：
ESP32-C3 作為 BLE 設備時，可能會遇到設備無法成功配對或連接的情況。

#### 可能的解決方案：
- **檢查藍牙開關**：確保您在程式中正確啟用了藍牙功能。ESP32-C3 支援 BLE，但不支援傳統藍牙（BR/EDR）。
- **檢查藍牙角色設置**：確認您設置的是 BLE 伺服器還是客戶端，並確保兩者的角色匹配。
- **檢查設備範圍**：如果設備距離過遠，信號可能會不穩定，請嘗試將設備更靠近。
- **檢查權限設置**：在一些系統中（如 Android），需要為藍牙應用授予特定的權限，請確保應用獲得適當的授權。

---

### 3. **無法正常啟動程式（上傳失敗）**

#### 問題描述：
在使用 Arduino IDE 或其他開發環境時，ESP32-C3 可能無法正常上傳程式，顯示錯誤信息或上傳過程中斷。

#### 可能的解決方案：
- **檢查 USB 連接**：確保 USB 連接穩定，並且數據線支持傳輸（不是僅充電用的數據線）。
- **選擇正確的開發板與端口**：在開發環境中選擇正確的 ESP32-C3 型號，並確認選擇的端口對應您的設備。
- **按下 BOOT 按鈕進入下載模式**：有時候需要按住 BOOT 按鈕來進入下載模式。這通常是 ESP32-C3 在上傳時的一個必須步驟。
- **重置設備**：若上傳過程持續失敗，嘗試重啟 ESP32-C3 並重新連接。

---

### 4. **記憶體不足錯誤**

#### 問題描述：
ESP32-C3 內部記憶體有限，在處理大量數據時，可能會出現記憶體不足的錯誤。

#### 可能的解決方案：
- **減少動態記憶體分配**：動態記憶體分配可能導致記憶體碎片化，建議在設計時儘量減少動態內存的使用，尤其是在大量資料處理的場景中。
- **使用 `heap_caps_malloc` 分配特定記憶體區域**：ESP32-C3 支援在特定的記憶體區域分配內存，例如使用 DRAM 或 SRAM，可以提高記憶體的管理效率。
- **檢查內存泄漏**：確保程式中沒有未釋放的記憶體。如果使用 `malloc` 或 `calloc` 等函數，記得在不需要時釋放記憶體。

```cpp
void *ptr = malloc(1000);
if (ptr == NULL) {
    Serial.println("Memory allocation failed");
}
free(ptr);
```

---

### 5. **程式執行緩慢或延遲過長**

#### 問題描述：
當應用程式需要處理多個任務或進行大量計算時，可能會出現延遲過長或程式執行緩慢的情況。

#### 可能的解決方案：
- **優化算法**：檢查程式中的算法是否高效，減少不必要的計算。嘗試使用更高效的數據結構，如哈希表、堆等，來提高資料存取速度。
- **使用硬體加速**：利用 ESP32-C3 的硬體加速功能（如 AES 加密引擎、數位信號處理等）來加速計算密集型任務。
- **調整 FreeRTOS 任務優先級**：合理設置任務的優先級，將重要的任務設為高優先級，減少不必要的上下文切換。

```cpp
xTaskCreatePinnedToCore(high_priority_task, "High Priority Task", 2048, NULL, 10, NULL, 0);
xTaskCreatePinnedToCore(low_priority_task, "Low Priority Task", 2048, NULL, 1, NULL, 1);
```

---

### 6. **Wi-Fi 訊號不穩定或丟失**

#### 問題描述：
ESP32-C3 在 Wi-Fi 連接過程中可能會遇到訊號不穩定或連接中斷的情況。

#### 可能的解決方案：
- **確認 Wi-Fi 頻段**：ESP32-C3 只能連接 2.4GHz 頻段的 Wi-Fi 網絡，請檢查您的路由器設置。
- **檢查訊號範圍**：若設備距離路由器過遠，Wi-Fi 訊號可能較弱，導致連接不穩定。可以考慮將設備移近路由器，或使用 Wi-Fi 擴展器。
- **使用靜態 IP**：某些情況下，使用 DHCP 可能會導致 IP 分配失敗，您可以考慮為 ESP32-C3 設置靜態 IP。

```cpp
WiFi.config(IPAddress(192, 168, 1, 100), IPAddress(255, 255, 255, 0), IPAddress(192, 168, 1, 1));
WiFi.begin(ssid, password);
```

---

### 7. **設備無法從深度睡眠模式喚醒**

#### 問題描述：
ESP32-C3 可能無法從深度睡眠模式喚醒，這通常是與配置或硬體設置有關。

#### 可能的解決方案：
- **檢查喚醒源設定**：確保您已正確設置喚醒源（如定時器、外部中斷等）。
- **避免長時間進入深度睡眠模式**：在某些情況下，設備可能無法正常喚醒。若需要頻繁喚醒，可以考慮使用輕度睡眠模式。

```cpp
esp_sleep_enable_timer_wakeup(1000000);  // 1秒鐘後喚醒
esp_deep_sleep_start();
```

---

### 8. **無法正確讀寫 SPIFFS 或 LittleFS**

#### 問題描述：
當使用 SPIFFS 或 LittleFS 文件系統時，可能會遇到無法正確讀寫文件的問題。

#### 可能的解決方案：
- **格式化 SPIFFS 或 LittleFS**：如果文件系統損壞，您可能需要格式化 SPIFFS 或 LittleFS。
- **檢查文件路徑與權限**：確認文件路徑是否正確，並確保對應的檔案有讀寫權限。

```cpp
if (!SPIFFS.begin(true)) {
    Serial.println("SPIFFS mount failed");
    return;
}
```

---

這些常見問題與解決方案可以幫助您更高效地開發 ESP32-C3 應用，並在遇到挑戰時迅速找到解決方案。