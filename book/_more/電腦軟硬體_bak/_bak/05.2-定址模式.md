### 5.2 定址模式

定址模式（Addressing Mode）是指令集架構中，用來指定操作數所在記憶體位置的一種方式。它定義了如何解釋指令中的操作數字段，並且影響處理器如何獲取數據以執行指令。不同的定址模式提供了不同的靈活性和效率，並且對指令的執行速度和設計複雜性有直接影響。

在現代計算機中，常見的定址模式通常包括以下幾種，它們可以單獨使用，也可以組合使用以提供更多功能：

#### 5.2.1 立即數定址（Immediate Addressing）
立即數定址模式是最簡單的一種定址模式。在這種模式中，操作數是直接嵌入在指令中的常數（即立即數）。立即數定址不需要進行記憶體訪問，因為操作數已經包含在指令本身中。

**範例**：
```
ADD R1, #5
```
在這個例子中，`#5` 是一個立即數，指令將數字 5 加到寄存器 R1 中。

優點：
- 計算速度快，因為操作數直接在指令中，無需額外的記憶體訪問。
- 簡單易用，適合表示常數。

缺點：
- 只適用於較簡單的運算，無法用於需要大量數據訪問的情況。

#### 5.2.2 寄存器定址（Register Addressing）
寄存器定址模式是將操作數存儲在寄存器中的一種方式。在這種模式下，指令會指定一個寄存器作為操作數的來源或目的地。所有的數據操作都會發生在寄存器之間，這樣的操作速度非常快，因為寄存器的存取速度比記憶體快得多。

**範例**：
```
ADD R1, R2, R3
```
在這個例子中，指令將寄存器 R2 和 R3 中的數據相加，並將結果存儲到寄存器 R1 中。

優點：
- 操作速度快，因為寄存器存取速度遠高於記憶體。
- 用於高效的寄存器間數據交換。

缺點：
- 寄存器數量有限，因此只能處理較少的數據。

#### 5.2.3 直接定址（Direct Addressing）
直接定址模式是指令直接指定記憶體地址，操作數位於該地址處。這種模式的指令中包含了操作數的具體地址，處理器只需從記憶體中讀取該地址處的數據即可。

**範例**：
```
MOV R1, [1000]
```
在這個例子中，指令會將記憶體地址 1000 處的數據讀取並存入寄存器 R1 中。

優點：
- 記憶體訪問簡單，且指令中明確指定了操作數的位置。
- 操作數可以存儲在大量的記憶體位置中。

缺點：
- 記憶體訪問速度較慢，比寄存器定址模式更慢。
- 地址大小受限，且需要額外的記憶體訪問操作。

#### 5.2.4 間接定址（Indirect Addressing）
間接定址模式是指令中包含一個記憶體地址，該地址存儲著另一個記憶體地址，最終操作數的位置。因此，處理器需要首先從該地址讀取一個新的地址，再使用這個新地址來訪問操作數。這種模式允許指令使用指向記憶體位置的指針。

**範例**：
```
MOV R1, [R2]
```
在這個例子中，`R2` 中存儲的是一個記憶體地址，處理器首先會從 `R2` 中讀取該地址，然後從該地址處讀取操作數並存入寄存器 R1。

優點：
- 支援動態訪問記憶體，方便實現指標和數據結構（如鏈表）。
- 可以靈活地訪問不同位置的數據。

缺點：
- 記憶體訪問需要兩次讀取，速度較慢。
- 需要額外的指針操作。

#### 5.2.5 基址定址（Base Addressing）
基址定址模式使用一個基址寄存器和一個偏移量來計算操作數的地址。指令中指定一個基址寄存器，並且操作數的實際地址是基址寄存器的內容加上一個偏移量。這種方式常用於數組、結構體等資料結構的操作。

**範例**：
```
MOV R1, [R2 + 4]
```
在這個例子中，`R2` 是基址寄存器，`4` 是偏移量。處理器將計算 `R2 + 4` 的結果，然後從該地址讀取數據並存入 R1 中。

優點：
- 支援數組和結構體等資料結構的高效訪問。
- 可以簡化複雜的數據結構操作。

缺點：
- 需要額外的加法運算來計算地址。

#### 5.2.6 相對定址（Relative Addressing）
相對定址模式使用指令中包含的偏移量來計算操作數的地址，這個偏移量相對於當前指令的地址。這種模式通常用於實現跳轉或分支指令，特別是在處理分支、迴圈等控制流指令時。

**範例**：
```
BEQ R1, R2, LABEL
```
在這個例子中，`LABEL` 是指令執行後跳轉的相對位置。如果 `R1` 和 `R2` 的值相等，處理器將跳轉到該標籤指定的地址。

優點：
- 用於控制流指令，特別是實現條件分支和迴圈。
- 方便計算相對地址，減少指令長度。

缺點：
- 需要計算偏移量，並且跳轉範圍有限。

#### 5.2.7 寄存器間接定址（Register Indirect Addressing）
寄存器間接定址模式是指指令使用一個寄存器作為指針，指向記憶體中的某個位置。這種模式可以用來實現類似間接定址的功能，但通過寄存器來進行地址的指向。

**範例**：
```
MOV R1, (R2)
```
在這個例子中，`R2` 寄存器包含一個記憶體地址，處理器會根據該地址讀取操作數，並將結果存入 R1。

優點：
- 支援動態記憶體訪問和指針操作。
- 可以實現更靈活的數據訪問。

缺點：
- 需要額外的寄存器操作。

#### 小結

定址模式提供了多種方式來存取操作數，每種模式都具有不同的優勢和局限。適當選擇定址模式可以提高指令的效率、簡化指令集並改善執行效能。不同的指令集架構（如 RISC、CISC）可能使用不同的定址模式來支持各種運算需求。在設計計算機處理器時，定址模式的選擇對整體架構和性能有著深遠的影響。